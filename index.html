<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>åŒ—æµ·é“è¡Œç¨‹ Web App 3.0</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Tailwind è‡ªè¨‚ä¸»é¡Œ -->
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            hokkaidoDark: "#041826",   // èƒŒæ™¯æ·±è—
            hokkaidoBlue: "#1D4ED8",   // ä¸»è—
            hokkaidoLight: "#E0F2FE",  // æ·ºè—
          },
          boxShadow: {
            soft: "0 10px 25px rgba(15,23,42,0.25)",
          },
        },
      },
    };
  </script>

  <!-- Vue 3 CDN -->
  <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>

  <style>
    /* Hero æ©¢åœ“å¼§å½¢éŠœæ¥æ•ˆæœ */
    .hero-mask-bottom {
      position: relative;
      overflow: hidden;
    }

    .hero-mask-bottom::after {
      content: "";
      position: absolute;
      left: 50%;
      bottom: -60px;
      transform: translateX(-50%);
      width: 140%;
      height: 120px;
      background-color: #ffffff;
      border-radius: 50%;
      z-index: 5;
    }

    /* è®“ä¸»å…§å®¹å¾€ä¸Šç–Šåˆ° hero åœ“å¼§ */
    .main-card {
      position: relative;
      z-index: 10;
      margin-top: -70px;
    }

    .map-frame {
      border: none;
      width: 100%;
      height: 260px;
      border-radius: 1rem;
    }

    /* æ‰‹æ©Ÿè¼¸å…¥æ¡†å»æ‰æ•¸å­—ç®­é ­ï¼ˆå¥½çœ‹ä¸€é»ï¼‰ */
    input[type="number"]::-webkit-inner-spin-button,
    input[type="number"]::-webkit-outer-spin-button {
      -webkit-appearance: none;
      margin: 0;
    }
    input[type="number"] {
      -moz-appearance: textfield;
    }
  </style>
</head>
<body class="bg-hokkaidoDark text-slate-100">
<div id="app" class="min-h-screen flex justify-center">
  <div class="w-full max-w-md pb-24">

    <!-- Hero / Banner -->
    <header class="hero-mask-bottom">
      <div
        class="h-[250px] w-full bg-cover bg-center"
        style="background-image: url('https://images.pexels.com/photos/360912/pexels-photo-360912.jpeg');"
      >
        <div class="w-full h-full bg-gradient-to-b from-hokkaidoDark/20 to-hokkaidoDark/75 flex flex-col justify-between p-4">
          <div class="flex justify-between items-center text-xs">
            <span class="px-2 py-1 rounded-full bg-black/40 backdrop-blur">
              åŒ—æµ·é“ 9 å¤©è¼•é¬†è¡Œ
            </span>
            <span class="px-2 py-1 rounded-full bg-black/40 backdrop-blur">
              2026 / 1 / 26 â€“ 2 / 3
            </span>
          </div>

          <div class="space-y-1">
            <h1 class="text-2xl font-semibold tracking-wide">
              Hokkaido Winter Trip
            </h1>
            <p class="text-sm text-slate-100/80">
              æœ­å¹Œãƒ»å°æ¨½ãƒ»æ”¯ç¬æ¹–ãƒ»åƒæ­²
              <span class="text-xs">é«”åŠ›ä¿ç•™çµ„å°ˆç”¨è¡Œç¨‹</span>
            </p>
          </div>
        </div>
      </div>
    </header>

    <!-- ä¸»å…§å®¹ -->
    <main class="main-card px-4">
      <section class="bg-white text-slate-900 rounded-3xl shadow-soft p-4 space-y-4">

        <!-- è¡Œç¨‹ / é ç®— / è¡Œæ ä¸‰å¤§é¡ -->
        <div class="flex items-center justify-between gap-2">
          <div>
            <p class="text-xs text-slate-400 uppercase tracking-wide">
              åŒ—æµ·é“ 2026
            </p>
            <p class="text-sm font-medium" v-if="activeMainView === 'plan'">
              è¡Œç¨‹ç¸½è¦½èˆ‡æ¯æ—¥åœ°åœ–
            </p>
            <p class="text-sm font-medium" v-else-if="activeMainView === 'budget'">
              é ç®—ãƒ»åŒ¯ç‡ãƒ»æ¯æ—¥èŠ±è²»
            </p>
            <p class="text-sm font-medium" v-else>
              è¡Œææ‰“åŒ…æ¸…å–®
            </p>
          </div>
          <div class="flex gap-2 text-[11px]">
            <span class="px-2 py-1 rounded-full bg-hokkaidoLight text-hokkaidoBlue font-medium">
              Cassandra & Ivy
            </span>
            <span class="px-2 py-1 rounded-full bg-slate-100">
              è‡ªç”¨æ—…è¡Œå° App
            </span>
          </div>
        </div>

        <!-- å…§é åˆ‡æ›å…§å®¹ -->
        <!-- â‘  è¡Œç¨‹é  -->
        <template v-if="activeMainView === 'plan'">

          <!-- èˆªç­ / ä½å®¿ / äº¤é€š tabs -->
          <div class="flex gap-2 text-xs mt-2">
            <button
              v-for="tab in tabs"
              :key="tab.id"
              @click="activeTab = tab.id"
              class="flex-1 py-2 rounded-2xl border text-center transition
                     hover:border-hokkaidoBlue hover:text-hokkaidoBlue"
              :class="activeTab === tab.id
                ? 'bg-hokkaidoBlue text-white border-hokkaidoBlue'
                : 'bg-slate-50 border-slate-200 text-slate-700'"
            >
              {{ tab.label }}
            </button>
          </div>

          <!-- Tab Content -->
          <div class="mt-3 space-y-3 text-sm">
            <!-- Flights -->
            <div v-if="activeTab === 'flight'" class="space-y-3">
              <div class="bg-slate-50 rounded-2xl p-3">
                <p class="text-xs font-semibold text-slate-500 mb-1">
                  å»ç¨‹ï½œ1 / 26ï¼ˆä¸€ï¼‰
                </p>
                <p class="font-medium">
                  å°ç£ âœˆ æ–°åƒæ­²ï¼ˆ08:35 â†’ 13:15ï¼‰
                </p>
                <p class="text-xs text-slate-500 mt-1">
                  æŠµé”å¾Œæ­ JR å¿«é€Ÿ Airport ç´„ 40 åˆ†é˜åˆ°æœ­å¹Œã€‚
                </p>
              </div>
              <div class="bg-slate-50 rounded-2xl p-3">
                <p class="text-xs font-semibold text-slate-500 mb-1">
                  å›ç¨‹ï½œ2 / 3ï¼ˆäºŒï¼‰
                </p>
                <p class="font-medium">
                  æ–°åƒæ­² âœˆ å°ç£ï¼ˆ14:40 â†’ 18:15ï¼‰
                </p>
                <p class="text-xs text-slate-500 mt-1">
                  å»ºè­°æ–¼èµ·é£›å‰ 3 å°æ™‚æŠµé”æ©Ÿå ´ï¼Œæœ€å¾Œæ¡è²·ä¼´æ‰‹ç¦®ã€‚
                </p>
              </div>
            </div>

            <!-- Hotels -->
            <div v-if="activeTab === 'stay'" class="space-y-3">
              <div class="bg-slate-50 rounded-2xl p-3 space-y-1">
                <p class="text-xs font-semibold text-slate-500">
                  æœ­å¹Œ 5 æ™šï¼ˆ1 / 26 â€“ 1 / 31ï¼‰
                </p>
                <p class="font-medium">äº¬ç‹ãƒ—ãƒ¬ãƒªã‚¢ãƒ›ãƒ†ãƒ«æœ­å¹Œï¼ˆKeio Prelia Hotelï¼‰</p>
                <p class="text-xs text-slate-500">
                  4 Chome-11-1 Kita 8 Jonishi, Kita Ward, Sapporo
                </p>
                <button
                  @click="openMaps('äº¬ç‹ãƒ—ãƒ¬ãƒªã‚¢ãƒ›ãƒ†ãƒ«æœ­å¹Œ')"
                  class="mt-2 inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-hokkaidoLight text-hokkaidoBlue"
                >
                  åœ¨ Google Maps é–‹å•Ÿ
                </button>
              </div>

              <div class="bg-slate-50 rounded-2xl p-3 space-y-1">
                <p class="text-xs font-semibold text-slate-500">
                  åƒæ­² 2 æ™šï¼ˆ2 / 1 â€“ 2 / 3ï¼‰
                </p>
                <p class="font-medium">Chiyoda-cho 3-13 ä¸€å¸¶ä½å®¿ï¼ˆåƒæ­²å¸‚ï¼‰</p>
                <p class="text-xs text-slate-500">
                  æ–¹ä¾¿å‰å¾€æ–°åƒæ­²æ©Ÿå ´èˆ‡æ”¯ç¬æ¹–å†°æ¿¤ç¥­ã€‚
                </p>
                <button
                  @click="openMaps('Chiyoda-cho 3-13 åƒæ­³å¸‚')"
                  class="mt-2 inline-flex items-center gap-1 px-2 py-1 rounded-full text-xs bg-hokkaidoLight text-hokkaidoBlue"
                >
                  åœ¨ Google Maps é–‹å•Ÿ
                </button>
              </div>
            </div>

            <!-- Transport -->
            <div v-if="activeTab === 'transport'" class="space-y-3">
              <div class="bg-slate-50 rounded-2xl p-3 space-y-1">
                <p class="text-xs font-semibold text-slate-500">
                  ä¸»è¦äº¤é€šæ¦‚å¿µï¼ˆä¸å«æ©Ÿç¥¨ï¼‰
                </p>
                <ul class="list-disc list-inside text-xs text-slate-600 space-y-1">
                  <li>æœ­å¹Œå¸‚å€ï¼šåœ°éµ / å¸‚é›» + å°‘é‡è¨ˆç¨‹è»Šï¼Œç„¡é ˆ JR Passã€‚</li>
                  <li>æœ­å¹Œ â‡„ å°æ¨½ï¼šJR å¾€è¿”å³å¯ï¼ˆå–®ç¨‹ç´„ Â¥750ï¼‰ã€‚</li>
                  <li>æœ­å¹Œ â‡„ åƒæ­²ï¼šJR å¿«é€Ÿ Airportã€‚</li>
                  <li>åƒæ­² â‡„ æ”¯ç¬æ¹–å†°æ¿¤ç¥­ï¼šæœ¬è¡Œç¨‹ä»¥ã€Œè¨ˆç¨‹è»Šå¾€è¿”ã€é ä¼°ï¼Œè»Šè³‡é ç®—è¼ƒé¬†ã€‚</li>
                </ul>
              </div>
              <div class="bg-slate-50 rounded-2xl p-3 space-y-1 text-xs text-slate-600">
                <p class="text-xs font-semibold text-slate-500">
                  ç²—ç•¥äº¤é€šè²»åƒè€ƒï¼ˆå…©äººåˆ†æ”¤è§€å¿µï¼‰
                </p>
                <ul class="list-disc list-inside space-y-1">
                  <li>JR / åœ°éµ / å¸‚é›»ï¼šç´„ Â¥8,000 / äººï¼ˆ9 å¤©ç¸½é¡ã€å«å°æ¨½ï¼‰ã€‚</li>
                  <li>æœ­å¹Œå¸‚å…§ & å°æ¨½å¸‚å…§è¨ˆç¨‹è»Šï¼šç´„ Â¥7,000â€“9,000 / è»Šã€‚</li>
                  <li>åƒæ­² â‡„ æ”¯ç¬æ¹–å†°æ¿¤ç¥­è¨ˆç¨‹è»Šï¼šç´„ Â¥14,000â€“18,000 / è»Šï¼ˆä¾†å›ï¼‰ã€‚</li>
                </ul>
                <p class="mt-1 text-[11px] text-slate-400">
                  å¯¦éš›èŠ±è²»ä»¥ä½ åœ¨ã€Œé ç®—é ã€å¡«çš„æ¯æ—¥é‡‘é¡ç‚ºæº–ï¼Œé€™è£¡åªæ˜¯æŠ“é¬†é¬†çš„ä¸Šé™åƒè€ƒã€‚
                </p>
              </div>
            </div>
          </div>

          <!-- æ—¥ç¨‹åˆ‡æ› -->
          <section class="mt-4 space-y-3">
            <div class="flex items-center justify-between">
              <h2 class="text-sm font-semibold text-slate-800">
                æ¯æ—¥è¡Œç¨‹ & å°è¨˜
              </h2>
              <p class="text-[11px] text-slate-400">
                é»é¸æ—¥æœŸæŸ¥çœ‹æ™¯é»èˆ‡åœ°åœ–
              </p>
            </div>

            <div class="flex gap-2 overflow-x-auto pb-1">
              <button
                v-for="day in days"
                :key="day.id"
                @click="selectDay(day.id)"
                class="flex-shrink-0 px-3 py-2 rounded-2xl border text-xs text-left transition"
                :class="currentDayId === day.id
                  ? 'bg-hokkaidoBlue text-white border-hokkaidoBlue'
                  : 'bg-slate-50 border-slate-200 text-slate-700'"
              >
                <div class="font-semibold">
                  Day {{ day.display }}
                </div>
                <div class="text-[11px]">
                  {{ day.shortTitle }}
                </div>
              </button>
            </div>

            <!-- ç•¶æ—¥æ‘˜è¦ -->
            <div class="bg-slate-50 rounded-2xl p-3 space-y-2 text-xs">
              <p class="font-semibold text-slate-700">
                {{ currentDay.title }}
              </p>
              <p class="text-slate-500">
                {{ currentDay.summary }}
              </p>
              <p class="text-[11px] text-slate-400" v-if="currentDay.area">
                ä¸»è¦å€åŸŸï¼š{{ currentDay.area }}
              </p>
            </div>

            <!-- Cassandra / Ivy å°è¨˜ -->
            <div class="bg-slate-50 rounded-2xl p-3 space-y-2 text-[11px]">
              <p class="font-semibold text-slate-700">
                ä»Šæ—¥å°è¨˜ï¼ˆæœƒä¿å­˜åœ¨é€™å°è£ç½®ï¼‰
              </p>
              <div class="space-y-2">
                <div>
                  <p class="text-[11px] text-slate-500 mb-1">Cassandra</p>
                  <textarea
                    v-model="dailyNotes[currentDayId].cassandra"
                    @input="saveState"
                    rows="2"
                    class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                    placeholder="ä»Šå¤©å¥½å†·ã€å¥½å¥½åƒã€æˆ–æ˜¯æƒ³è¨˜éŒ„çš„ä»»ä½•äº‹..."
                  ></textarea>
                </div>
                <div>
                  <p class="text-[11px] text-slate-500 mb-1">Ivy</p>
                  <textarea
                    v-model="dailyNotes[currentDayId].ivy"
                    @input="saveState"
                    rows="2"
                    class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                    placeholder="Ivy æƒ³å¯«ä»€éº¼å°±å¯«ä»€éº¼ï½"
                  ></textarea>
                </div>
              </div>
            </div>

            <!-- æ™¯é»åˆ—è¡¨ -->
            <div class="space-y-2 text-xs">
              <div
                v-for="spot in currentDay.spots"
                :key="spot.name"
                class="flex items-start gap-3 bg-slate-50 rounded-2xl p-3"
                :class="spot.name === currentSpot.name ? 'ring-2 ring-hokkaidoBlue/60' : ''"
              >
                <button
                  class="mt-1 w-8 h-8 rounded-full flex items-center justify-center text-[11px] font-semibold"
                  :class="spot.category === 'æ™¯é»'
                    ? 'bg-hokkaidoLight text-hokkaidoBlue'
                    : spot.category === 'ç¾é£Ÿ'
                      ? 'bg-amber-100 text-amber-700'
                      : 'bg-emerald-100 text-emerald-700'"
                  @click="setCurrentSpot(spot)"
                >
                  {{ spot.icon }}
                </button>
                <div class="flex-1">
                  <div class="flex justify-between gap-2">
                    <p class="font-semibold text-slate-800">
                      {{ spot.name }}
                    </p>
                    <span class="text-[11px] text-slate-400">
                      {{ spot.category }}
                    </span>
                  </div>
                  <p class="text-slate-500 mt-0.5">
                    {{ spot.note }}
                  </p>
                  <div class="flex gap-2 mt-2">
                    <button
                      @click="setCurrentSpot(spot)"
                      class="px-2 py-1 rounded-full bg-white border border-slate-200 text-[11px]"
                    >
                      æŸ¥çœ‹åœ°åœ–
                    </button>
                    <button
                      @click="openMaps(spot.mapsQuery)"
                      class="px-2 py-1 rounded-full bg-hokkaidoBlue text-white text-[11px]"
                    >
                      åœ¨ Google Maps é–‹å•Ÿå°èˆª
                    </button>
                  </div>
                </div>
              </div>
            </div>

            <!-- Google Maps å€ -->
            <div class="bg-slate-900 rounded-2xl p-3 text-xs text-slate-100 space-y-2">
              <div class="flex justify-between items-center">
                <div>
                  <p class="text-[11px] text-slate-400">
                    ç›®å‰é¸æ“‡æ™¯é»
                  </p>
                  <p class="text-sm font-semibold">
                    {{ currentSpot.name }}
                  </p>
                </div>
                <span class="text-[11px] px-2 py-1 rounded-full bg-slate-800">
                  {{ currentSpot.category }}
                </span>
              </div>
              <iframe
                class="map-frame mt-1"
                :src="mapEmbedUrl"
                loading="lazy"
                referrerpolicy="no-referrer-when-downgrade"
              ></iframe>
            </div>
          </section>
        </template>

        <!-- â‘¡ é ç®— / åŒ¯ç‡é  -->
        <template v-else-if="activeMainView === 'budget'">
          <!-- åŒ¯ç‡ & æ›ç®— -->
          <div class="space-y-3 text-xs">
            <div class="bg-slate-50 rounded-2xl p-3 space-y-2">
              <p class="font-semibold text-slate-700 text-sm">
                åŒ¯ç‡ & æ—¥åœ“æ›ç®—
              </p>
              <p class="text-[11px] text-slate-500">
                å»ºè­°å¾ã€Œå°ç£éŠ€è¡ŒåŒ¯ç‡è¡¨ã€æ‰¾æ—¥åœ“çš„ã€Œå³æœŸç¾é‡‘è³£å‡ºåƒ¹ã€ï¼Œå¦‚æœçœ‹åˆ°çš„æ˜¯ã€Œ100 æ—¥åœ“ = 23.0 å…ƒã€ï¼Œé€™è£¡è«‹è¼¸å…¥ <span class="font-mono">0.23</span>ã€‚
              </p>
              <div class="flex items-center gap-2 mt-1">
                <span class="text-[11px] text-slate-500 w-16">1 æ—¥åœ“ â‰ˆ</span>
                <input
                  v-model="rateTwdPerJpy"
                  @input="saveState"
                  type="number"
                  step="0.0001"
                  inputmode="decimal"
                  class="flex-1 rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                  placeholder="ä¾‹å¦‚ 0.23"
                />
                <span class="text-[11px] text-slate-500">å°å¹£</span>
              </div>

              <div class="flex items-center gap-2 mt-2">
                <input
                  v-model="yenInput"
                  @input="saveState"
                  type="number"
                  inputmode="numeric"
                  class="w-28 rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                  placeholder="è¼¸å…¥æ—¥åœ“"
                />
                <span class="text-[11px]">æ—¥åœ“ â‰ˆ</span>
                <div class="flex-1 text-right font-semibold text-slate-700">
                  <span v-if="convertedTwd !== ''">{{ convertedTwd }} å…ƒ</span>
                  <span v-else>â€”</span>
                </div>
              </div>
            </div>

            <!-- Cassandra & Ivy é ç®—å¡ -->
            <div class="grid grid-cols-1 gap-3">
              <!-- Cassandra -->
              <div class="bg-slate-50 rounded-2xl p-3 space-y-2">
                <div class="flex items-center justify-between">
                  <p class="font-semibold text-slate-800">
                    Cassandra çš„é ç®—
                  </p>
                  <span class="text-[11px] text-pink-600 bg-pink-50 px-2 py-1 rounded-full">
                    å»ºè­°ä¸Šé™ï¼šç´„ 26,000 TWD
                  </span>
                </div>
                <div class="space-y-2">
                  <div>
                    <p class="text-[11px] text-slate-500 mb-1">
                      é ç®—ï¼ˆå°å¹£ï¼‰ï¼ä½ è‡ªå·±æ‰“å°±å¥½
                    </p>
                    <input
                      v-model="persons.cassandra.budgetTwd"
                      @input="saveState"
                      type="number"
                      inputmode="numeric"
                      class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                      placeholder="ä¾‹å¦‚ 26000"
                    />
                  </div>
                  <div>
                    <p class="text-[11px] text-slate-500 mb-1">
                      è‹¥æƒ³ç›´æ¥ç”¨ã€Œæ—¥åœ“æ•´åŒ…é ç®—ã€ï¼Œå¯åœ¨é€™è£¡å¡«ï¼ˆé¸å¡«ï¼‰
                    </p>
                    <input
                      v-model="persons.cassandra.budgetJpyOverride"
                      @input="saveState"
                      type="number"
                      inputmode="numeric"
                      class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                      placeholder="ä¾‹å¦‚ 130000"
                    />
                  </div>

                  <div class="text-[11px] text-slate-600 space-y-1">
                    <p>
                      ç›®å‰é ç®—ï¼ˆæ—¥åœ“ä¼°ç®—ï¼‰ï¼š
                      <span class="font-mono font-semibold" v-if="budgetJpy('cassandra') !== null">
                        ç´„ {{ budgetJpy('cassandra') }} Â¥
                      </span>
                      <span v-else>â€”</span>
                    </p>
                    <p>
                      å·²è¼¸å…¥èŠ±è²»ç¸½é¡ï¼š
                      <span class="font-mono font-semibold">
                        {{ totalSpent('cassandra') }} Â¥
                      </span>
                    </p>
                    <p>
                      é ä¼°å‰©é¤˜å¯ç”¨ï¼š
                      <span class="font-mono font-semibold" v-if="budgetJpy('cassandra') !== null">
                        {{ remainingJpy('cassandra') }} Â¥
                      </span>
                      <span v-else>â€”</span>
                    </p>
                    <div class="w-full h-2 rounded-full bg-slate-200 overflow-hidden mt-1">
                      <div
                        class="h-2 bg-hokkaidoBlue transition-all"
                        :style="{ width: cassandraProgressBar + '%' }"
                      ></div>
                    </div>
                  </div>
                </div>

                <!-- æ¯æ—¥èŠ±è²»è¼¸å…¥ï¼ˆCassandraï¼‰ -->
                <div class="mt-2 border-t border-slate-200 pt-2 space-y-1">
                  <p class="text-[11px] text-slate-500 mb-1">
                    æ¯æ—¥å¯¦éš›èŠ±è²»ï¼ˆæ—¥åœ“ï¼‰ï¼Cassandra å°ˆç”¨
                  </p>
                  <div class="max-h-40 overflow-y-auto pr-1 space-y-1">
                    <div
                      v-for="day in days"
                      :key="'cassy-' + day.id"
                      class="flex items-center gap-2"
                    >
                      <span class="w-20 text-[11px] text-slate-500">
                        Day {{ day.display }}
                      </span>
                      <input
                        v-model="persons.cassandra.dailySpending[day.id]"
                        @input="saveState"
                        type="number"
                        inputmode="numeric"
                        class="flex-1 rounded-xl border border-slate-200 px-2 py-1 text-[11px] focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                        placeholder="è¼¸å…¥ç•¶å¤©èŠ±è²» Â¥"
                      />
                    </div>
                  </div>
                </div>
              </div>

              <!-- Ivy -->
              <div class="bg-slate-50 rounded-2xl p-3 space-y-2">
                <div class="flex items-center justify-between">
                  <p class="font-semibold text-slate-800">
                    Ivy çš„é ç®—
                  </p>
                  <span class="text-[11px] text-emerald-700 bg-emerald-50 px-2 py-1 rounded-full">
                    å»ºè­°ä¸Šé™ï¼šç´„ 20,000 TWD
                  </span>
                </div>
                <div class="space-y-2">
                  <div>
                    <p class="text-[11px] text-slate-500 mb-1">
                      é ç®—ï¼ˆå°å¹£ï¼‰ï¼Ivy è‡ªå·±å¡«
                    </p>
                    <input
                      v-model="persons.ivy.budgetTwd"
                      @input="saveState"
                      type="number"
                      inputmode="numeric"
                      class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                      placeholder="ä¾‹å¦‚ 20000"
                    />
                  </div>
                  <div>
                    <p class="text-[11px] text-slate-500 mb-1">
                      è‹¥æƒ³ç›´æ¥ç”¨ã€Œæ—¥åœ“æ•´åŒ…é ç®—ã€ï¼Œå¯åœ¨é€™è£¡å¡«ï¼ˆé¸å¡«ï¼‰
                    </p>
                    <input
                      v-model="persons.ivy.budgetJpyOverride"
                      @input="saveState"
                      type="number"
                      inputmode="numeric"
                      class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                      placeholder="ä¾‹å¦‚ 100000"
                    />
                  </div>

                  <div class="text-[11px] text-slate-600 space-y-1">
                    <p>
                      ç›®å‰é ç®—ï¼ˆæ—¥åœ“ä¼°ç®—ï¼‰ï¼š
                      <span class="font-mono font-semibold" v-if="budgetJpy('ivy') !== null">
                        ç´„ {{ budgetJpy('ivy') }} Â¥
                      </span>
                      <span v-else>â€”</span>
                    </p>
                    <p>
                      å·²è¼¸å…¥èŠ±è²»ç¸½é¡ï¼š
                      <span class="font-mono font-semibold">
                        {{ totalSpent('ivy') }} Â¥
                      </span>
                    </p>
                    <p>
                      é ä¼°å‰©é¤˜å¯ç”¨ï¼š
                      <span class="font-mono font-semibold" v-if="budgetJpy('ivy') !== null">
                        {{ remainingJpy('ivy') }} Â¥
                      </span>
                      <span v-else>â€”</span>
                    </p>
                    <div class="w-full h-2 rounded-full bg-slate-200 overflow-hidden mt-1">
                      <div
                        class="h-2 bg-emerald-500 transition-all"
                        :style="{ width: ivyProgressBar + '%' }"
                      ></div>
                    </div>
                  </div>
                </div>

                <!-- æ¯æ—¥èŠ±è²»è¼¸å…¥ï¼ˆIvyï¼‰ -->
                <div class="mt-2 border-t border-slate-200 pt-2 space-y-1">
                  <p class="text-[11px] text-slate-500 mb-1">
                    æ¯æ—¥å¯¦éš›èŠ±è²»ï¼ˆæ—¥åœ“ï¼‰ï¼Ivy å°ˆç”¨
                  </p>
                  <div class="max-h-40 overflow-y-auto pr-1 space-y-1">
                    <div
                      v-for="day in days"
                      :key="'ivy-' + day.id"
                      class="flex items-center gap-2"
                    >
                      <span class="w-20 text-[11px] text-slate-500">
                        Day {{ day.display }}
                      </span>
                      <input
                        v-model="persons.ivy.dailySpending[day.id]"
                        @input="saveState"
                        type="number"
                        inputmode="numeric"
                        class="flex-1 rounded-xl border border-slate-200 px-2 py-1 text-[11px] focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                        placeholder="è¼¸å…¥ç•¶å¤©èŠ±è²» Â¥"
                      />
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- å°æé†’ -->
            <div class="bg-slate-50 rounded-2xl p-3 text-[11px] text-slate-500 space-y-1">
              <p class="font-semibold text-slate-700">
                ä½¿ç”¨æç¤º
              </p>
              <ul class="list-disc list-inside space-y-1">
                <li>åŒ¯ç‡ã€é ç®—ã€æ¯æ—¥é‡‘é¡ã€å‚™è¨»éƒ½æœƒå­˜åœ¨é€™å°è£ç½®çš„ç€è¦½å™¨è£¡ï¼ˆlocalStorageï¼‰ã€‚</li>
                <li>æ›æ‰‹æ©Ÿæˆ–æ›ç€è¦½å™¨ï¼Œè³‡æ–™å°±æœƒæ˜¯æ–°çš„ï¼ˆä¸æœƒè·¨è£ç½®åŒæ­¥ï¼‰ã€‚</li>
                <li>ä¸ä¸€å®šè¦å¡«æ»¿ï¼Œç•¶æˆã€Œè¨˜å¸³ï¼‹å¤§æ–¹å‘æé†’ã€å°±å¥½ï¼Œä¸éœ€è¦é€¼è‡ªå·±å¤ªç²¾æº–ã€‚</li>
              </ul>
            </div>
          </div>
        </template>

        <!-- â‘¢ è¡Œææ‰“åŒ…é  -->
        <template v-else>
          <div class="space-y-3 text-xs">
            <div class="bg-slate-50 rounded-2xl p-3 space-y-2">
              <p class="font-semibold text-slate-700 text-sm">
                è¡Œææ‰“åŒ…æ¸…å–®ï¼ˆå…±ç”¨ï¼‰
              </p>
              <p class="text-[11px] text-slate-500">
                å¯ä»¥é‚Šæº–å‚™é‚Šå‹¾ï¼Œå‹¾é¸ç‹€æ…‹æœƒä¿ç•™ã€‚ä¹‹å¾Œé‚„å¯ä»¥è‡ªå·±æ–°å¢é …ç›®ã€‚
              </p>
              <div class="space-y-1 max-h-44 overflow-y-auto pr-1 mt-1">
                <div
                  v-for="(item, idx) in packing.items"
                  :key="'pack-' + idx"
                  class="flex items-center gap-2"
                >
                  <input
                    type="checkbox"
                    v-model="item.done"
                    @change="saveState"
                    class="w-4 h-4 rounded border-slate-300 text-hokkaidoBlue focus:ring-hokkaidoBlue"
                  />
                  <span
                    class="text-[11px]"
                    :class="item.done ? 'line-through text-slate-400' : 'text-slate-700'"
                  >
                    {{ item.text }}
                  </span>
                </div>
              </div>

              <!-- æ–°å¢é …ç›® -->
              <div class="flex items-center gap-2 mt-2">
                <input
                  v-model="newPackingItem"
                  @keyup.enter="addPackingItem"
                  type="text"
                  class="flex-1 rounded-xl border border-slate-200 px-2 py-1 text-[11px] focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                  placeholder="æ–°å¢è‡ªå·±çš„æ‰“åŒ…é …ç›®ï¼ˆæŒ‰ Enter å„²å­˜ï¼‰"
                />
                <button
                  @click="addPackingItem"
                  class="px-2 py-1 rounded-xl bg-hokkaidoBlue text-white text-[11px]"
                >
                  åŠ å…¥
                </button>
              </div>
            </div>

            <!-- Cassandra / Ivy è¡Œæå‚™è¨» -->
            <div class="bg-slate-50 rounded-2xl p-3 space-y-2">
              <p class="font-semibold text-slate-700 text-sm">
                Cassandra å°ˆå±¬å‚™è¨»
              </p>
              <textarea
                v-model="packing.cassandraNotes"
                @input="saveState"
                rows="3"
                class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                placeholder="ä¾‹å¦‚ï¼šè—¥å“ã€ä¿é¤Šå“ã€åŒ—æµ·é“ç‰¹åˆ¥æƒ³å¸¶çš„è¡£ç‰©..."
              ></textarea>
            </div>

            <div class="bg-slate-50 rounded-2xl p-3 space-y-2">
              <p class="font-semibold text-slate-700 text-sm">
                Ivy å°ˆå±¬å‚™è¨»
              </p>
              <textarea
                v-model="packing.ivyNotes"
                @input="saveState"
                rows="3"
                class="w-full rounded-xl border border-slate-200 px-2 py-1 text-xs focus:outline-none focus:ring-1 focus:ring-hokkaidoBlue"
                placeholder="ä¾‹å¦‚ï¼šå€‹äººè—¥å“ã€é›»å­ç”¨å“ã€æ›æ´—è¡£ç‰©..."
              ></textarea>
            </div>
          </div>
        </template>
      </section>

      <!-- åº•éƒ¨å›ºå®šå°èˆªæ¢ï¼ˆçœŸçš„å¯ä»¥åˆ‡æ›é é¢ï¼‰ -->
      <nav
        class="fixed bottom-0 left-0 right-0 max-w-md mx-auto px-6 py-2 rounded-t-3xl bg-black/60 backdrop-blur flex justify-between text-[11px] text-slate-200"
      >
        <button
          class="flex flex-col items-center gap-0.5"
          @click="activeMainView = 'plan'"
        >
          <span :class="activeMainView === 'plan' ? 'font-semibold' : 'opacity-70'">
            è¡Œç¨‹
          </span>
        </button>
        <button
          class="flex flex-col items-center gap-0.5"
          @click="activeMainView = 'budget'"
        >
          <span :class="activeMainView === 'budget' ? 'font-semibold' : 'opacity-70'">
            é ç®—
          </span>
        </button>
        <button
          class="flex flex-col items-center gap-0.5"
          @click="activeMainView = 'packing'"
        >
          <span :class="activeMainView === 'packing' ? 'font-semibold' : 'opacity-70'">
            è¡Œæ
          </span>
        </button>
      </nav>
    </main>
  </div>
</div>

<script>
  const { createApp, computed } = Vue;

  createApp({
    data() {
      return {
        activeMainView: "plan", // plan / budget / packing
        tabs: [
          { id: "flight", label: "èˆªç­" },
          { id: "stay",   label: "ä½å®¿" },
          { id: "transport", label: "äº¤é€š" },
        ],
        activeTab: "flight",
        currentDayId: "d1",
        currentSpot: {
          name: "æ–°åƒæ­²æ©Ÿå ´",
          category: "äº¤é€š",
          mapsQuery: "æ–°åƒæ­³ç©ºæ¸¯",
          note: "åŒ—æµ·é“çš„å…¥å£ï¼Œä¹Ÿæ˜¯æœ€å¾Œæ¡è²·ä¼´æ‰‹ç¦®çš„å¥½åœ°æ–¹ã€‚",
          icon: "âœˆï¸",
        },
        // åŒ¯ç‡ & é ç®—
        rateTwdPerJpy: "",
        yenInput: "",
        persons: {
          cassandra: {
            name: "Cassandra",
            suggestedTwd: 26000,
            budgetTwd: "",
            budgetJpyOverride: "",
            dailySpending: {},
          },
          ivy: {
            name: "Ivy",
            suggestedTwd: 20000,
            budgetTwd: "",
            budgetJpyOverride: "",
            dailySpending: {},
          },
        },
        // æ¯æ—¥å°è¨˜
        dailyNotes: {},

        // è¡Œæ
        packing: {
          items: [
            { text: "è­·ç…§ & èº«åˆ†è­‰", done: false },
            { text: "æ©Ÿç¥¨ / é›»å­æ©Ÿç¥¨æˆªåœ–", done: false },
            { text: "æ—¥åœ“ç¾é‡‘ & ä¿¡ç”¨å¡", done: false },
            { text: "æ—¥æœ¬ä¸Šç¶² / eSIM / Wi-Fi æ©Ÿ", done: false },
            { text: "å¸¸å‚™è—¥å“ï¼ˆæ„Ÿå†’è—¥ã€è…¸èƒƒè—¥ã€éæ•è—¥ï¼‰", done: false },
            { text: "ç™¼ç†±è¡£ Ã— 2ã€ç™¼ç†±è¤² Ã— 2", done: false },
            { text: "åšå¤–å¥— / ç¾½çµ¨è¡£", done: false },
            { text: "å¸½å­ã€åœå·¾ã€æ‰‹å¥—", done: false },
            { text: "åšè¥ªå­ & é˜²æ»‘é‹ / é›ªé´", done: false },
            { text: "è¡Œå‹•é›»æº & å……é›»ç·š", done: false },
            { text: "ç›¸æ©Ÿ / æ‰‹æ©Ÿå‚™ç”¨å„²å­˜ç©ºé–“", done: false },
            { text: "ä¿é¤Šå“ & å¸å¦ç”¨å“", done: false },
          ],
          cassandraNotes: "",
          ivyNotes: "",
        },
        newPackingItem: "",

        // è¡Œç¨‹å¤©æ•¸
        days: [
          {
            id: "d1",
            display: 1,
            shortTitle: "æŠµé”æœ­å¹Œãƒ»å¯¶å¯å¤¢ä¸­å¿ƒ",
            title: "Day 1ï½œ1 / 26ï¼ˆä¸€ï¼‰æŠµé” & æœ­å¹Œè»Šç«™å‘¨é‚Š",
            summary: "æ–°åƒæ­²æ©Ÿå ´æŠµé” â†’ JR æœ­å¹Œ â†’ é£¯åº— Check-in â†’ å¯¶å¯å¤¢ä¸­å¿ƒ & æœ­å¹Œè»Šç«™é€›è¡—ã€‚",
            area: "æ–°åƒæ­²ãƒ»æœ­å¹Œè»Šç«™",
            spots: [
              {
                name: "æ–°åƒæ­²æ©Ÿå ´",
                category: "äº¤é€š",
                mapsQuery: "æ–°åƒæ­³ç©ºæ¸¯",
                note: "æŠµé”å¾Œæ­ JR å¿«é€Ÿ Airport ç´„ 40 åˆ†é˜åˆ°æœ­å¹Œã€‚",
                icon: "âœˆï¸",
              },
              {
                name: "äº¬ç‹ãƒ—ãƒ¬ãƒªã‚¢ãƒ›ãƒ†ãƒ«æœ­å¹Œ",
                category: "ä½å®¿",
                mapsQuery: "äº¬ç‹ãƒ—ãƒ¬ãƒªã‚¢ãƒ›ãƒ†ãƒ«æœ­å¹Œ",
                note: "æœ­å¹Œç«™åŒ—å£æ­¥è¡Œç´„ 3â€“5 åˆ†é˜ï¼Œå›é£¯åº—æ³¡å¤§æµ´å ´ã€‚",
                icon: "ğŸ¨",
              },
              {
                name: "å¯¶å¯å¤¢ä¸­å¿ƒ æœ­å¹Œï¼ˆå¤§ä¸¸ 8Fï¼‰",
                category: "æ™¯é»",
                mapsQuery: "ãƒã‚±ãƒ¢ãƒ³ã‚»ãƒ³ã‚¿ãƒ¼ã‚µãƒƒãƒãƒ­",
                note: "æŠµé”ç¬¬ä¸€å¤©åªè·‘è»Šç«™å¤§æ¨“ï¼Œè¼•é¬†æ¡è³¼ã€‚",
                icon: "ğŸ§¸",
              },
            ],
          },
          {
            id: "d2",
            display: 2,
            shortTitle: "åŒ—å¤§ãƒ»åŒ—æµ·é“ç¥å®®",
            title: "Day 2ï½œ1 / 27ï¼ˆäºŒï¼‰åŒ—æµ·é“å¤§å­¸ & åŒ—æµ·é“ç¥å®®",
            summary: "ä¸ŠåˆåŒ—æµ·é“å¤§å­¸é›ªæ™¯ï¼Œä¸‹åˆåŒ—æµ·é“ç¥å®® & å…­èŠ±äº­åˆ¤å®˜é¤…ï¼Œæ™šé¤æˆå‰æ€æ±—çƒ¤è‚‰ã€‚",
            area: "æœ­å¹ŒåŒ—å€ãƒ»åœ“å±±",
            spots: [
              {
                name: "åŒ—æµ·é“å¤§å­¸ï¼ˆæœ­å¹Œæ ¡å€ï¼‰",
                category: "æ™¯é»",
                mapsQuery: "åŒ—æµ·é“å¤§å­¦ æœ­å¹Œã‚­ãƒ£ãƒ³ãƒ‘ã‚¹",
                note: "åªèµ°æ ¡é–€èˆ‡å…‹æ‹‰å…‹åƒä¸€å¸¶ï¼Œé«”åŠ›ä¿ç•™ã€‚",
                icon: "ğŸ“",
              },
              {
                name: "åŒ—æµ·é“ç¥å®®",
                category: "æ™¯é»",
                mapsQuery: "åŒ—æµ·é“ç¥å®®",
                note: "å†¬å­£é›ªæ™¯éå¸¸æ¼‚äº®ï¼Œå¯é †è¨ªå…­èŠ±äº­ç¥å®®èŒ¶å±‹ã€‚",
                icon: "â›©ï¸",
              },
              {
                name: "å…­èŠ±äº­ ç¥å®®èŒ¶å±‹",
                category: "ç¾é£Ÿ",
                mapsQuery: "å…­èŠ±äº­ ç¥å®®èŒ¶å±‹",
                note: "å“åšç†±é¨°é¨°åˆ¤å®˜é¤…ï¼Œæš–èº«ä¼‘æ¯ã€‚",
                icon: "ğŸ¡",
              },
            ],
          },
          {
            id: "d3",
            display: 3,
            shortTitle: "äºŒæ¢å¸‚å ´ãƒ»è«è¨ªç¥ç¤¾ãƒ»è—»å²©å±±",
            title: "Day 3ï½œ1 / 28ï¼ˆä¸‰ï¼‰æµ·é®®ä¸¼ & è—»å²©å±±å¤œæ™¯",
            summary: "æ—©ä¸Šæµ·é®®ä¸¼ + è«è¨ªç¥ç¤¾ï¼Œä¸‹åˆå›é£¯åº—åˆç¡ï¼Œæ™šä¸Šè—»å²©å±±å¤œæ™¯ã€‚",
            area: "æœ­å¹Œä¸­å¿ƒãƒ»å—å€",
            spots: [
              {
                name: "äºŒæ¢å¸‚å ´",
                category: "ç¾é£Ÿ",
                mapsQuery: "äºŒæ¡å¸‚å ´ æœ­å¹Œ",
                note: "æµ·é®®ä¸¼ã€èƒèŸ¹ã€æµ·ç”¢æ—©åˆé¤ä¸€æ¬¡æ»¿è¶³ã€‚",
                icon: "ğŸ¦€",
              },
              {
                name: "æœ­å¹Œè«è¨ªç¥ç¤¾",
                category: "æ™¯é»",
                mapsQuery: "æœ­å¹Œ è«è¨ªç¥ç¤¾",
                note: "èŠ±æ‰‹æ°´æ‹ç…§å¯æ„›å°æ™¯é»ï¼Œä¸ç”¨åœå¤ªä¹…ã€‚",
                icon: "ğŸ™",
              },
              {
                name: "è—»å²©å±±çºœè»Šãƒ»å±•æœ›å°",
                category: "æ™¯é»",
                mapsQuery: "æœ­å¹Œã‚‚ã„ã‚å±±ãƒ­ãƒ¼ãƒ—ã‚¦ã‚§ã‚¤",
                note: "æœ­å¹Œç™¾è¬å¤œæ™¯ï¼Œçœ‹å®Œç›´æ¥ä¸‹å±±è¦“é£Ÿã€‚",
                icon: "ğŸŒƒ",
              },
            ],
          },
          {
            id: "d4",
            display: 4,
            shortTitle: "å¤§é€šå…¬åœ’ãƒ»ç‹¸å°è·¯",
            title: "Day 4ï½œ1 / 29ï¼ˆå››ï¼‰åœ°ä¸‹è¡—é€›è¡—æ—¥",
            summary: "èµ°åœ°ä¸‹æ­¥è¡Œç©ºé–“åˆ°å¤§é€šå…¬åœ’ã€é›»è¦–å¡”ï¼Œå†åˆ°ç‹¸å°è·¯å•†åº—è¡—èˆ‡å’–å•¡å»³ã€‚",
            area: "æœ­å¹Œå¸‚ä¸­å¿ƒ",
            spots: [
              {
                name: "å¤§é€šå…¬åœ’ & é›»è¦–å¡”å‘¨é‚Š",
                category: "æ™¯é»",
                mapsQuery: "å¤§é€šå…¬åœ’ æœ­å¹Œ",
                note: "å†¬å­£é›ªæ™¯ï¼Œèƒ½çœ‹åˆ°é›ªç¥­æº–å‚™ç¾å ´ã€‚",
                icon: "ğŸ—¼",
              },
              {
                name: "ç‹¸å°è·¯å•†åº—è¡—",
                category: "æ™¯é»",
                mapsQuery: "ç‹¸å°è·¯å•†åº—è¡—",
                note: "æœ‰å±‹é ‚çš„å•†åº—è¡—ï¼Œé€›è¡—é¿å¯’å¥½é¸æ“‡ã€‚",
                icon: "ğŸ›ï¸",
              },
              {
                name: "ç‹¸å°è·¯å‘¨é‚Šå’–å•¡å»³",
                category: "ç¾é£Ÿ",
                mapsQuery: "ç‹¸å°è·¯ ã‚«ãƒ•ã‚§",
                note: "ä¸‹åˆæ‰¾é–“å’–å•¡å»³åè‘—èŠå¤©ã€ä¼‘æ¯ã€‚",
                icon: "â˜•",
              },
            ],
          },
          {
            id: "d5",
            display: 5,
            shortTitle: "å°æ¨½ä¸€æ—¥éŠ",
            title: "Day 5ï½œ1 / 30ï¼ˆäº”ï¼‰å°æ¨½é‹æ²³ & éŸ³æ¨‚ç›’å ‚",
            summary: "JR å‰å¾€å°æ¨½ï¼Œæ•£æ­¥å ºç”ºé€šã€å°æ¨½éŸ³æ¨‚ç›’å ‚èˆ‡é‹æ²³å¤œæ™¯ã€‚",
            area: "å°æ¨½",
            spots: [
              {
                name: "å—å°æ¨½ç«™",
                category: "äº¤é€š",
                mapsQuery: "å—å°æ¨½é§…",
                note: "ä¸‹è»Šå¾Œä»¥ç·©ä¸‹å¡èµ°å‘å ºç”ºé€šï¼Œé«”åŠ›è¼ƒçœã€‚",
                icon: "ğŸš‰",
              },
              {
                name: "å°æ¨½éŸ³æ¨‚ç›’å ‚ 2 è™Ÿé¤¨ å¤è‘£éŸ³æ¨‚ç›’åšç‰©é¤¨",
                category: "æ™¯é»",
                mapsQuery: "å°æ¨½ã‚ªãƒ«ã‚´ãƒ¼ãƒ«å ‚ ç¬¬äºŒè™Ÿé¤¨ ã‚¢ãƒ³ãƒ†ã‚£ãƒ¼ã‚¯ãƒŸãƒ¥ãƒ¼ã‚¸ã‚¢ãƒ ",
                note: "ä½ çš„å¿…å»æ™¯é»ä¹‹ä¸€ï¼Œå…ˆæ’é€²è¡Œç¨‹å‰æ®µã€‚",
                icon: "ğŸµ",
              },
              {
                name: "å°æ¨½é‹æ²³",
                category: "æ™¯é»",
                mapsQuery: "å°æ¨½é‹æ²³",
                note: "å‚æ™šé»ç‡ˆæœ€æµªæ¼«ï¼Œå¯ä»¥æ‹å¾ˆå¤šç…§ç‰‡ã€‚",
                icon: "ğŸŒŠ",
              },
              {
                name: "æ”¿å£½å¸ï¼å£½å¸åº—",
                category: "ç¾é£Ÿ",
                mapsQuery: "æ”¿å¯¿å¸ å°æ¨½",
                note: "æ™šé¤å“åšå£½å¸ã€ç”Ÿé­šç‰‡ã€èƒèŸ¹æ–™ç†ã€‚",
                icon: "ğŸ£",
              },
            ],
          },
          {
            id: "d6",
            display: 6,
            shortTitle: "æœ­å¹Œå½ˆæ€§è‡ªç”±æ—¥",
            title: "Day 6ï½œ1 / 31ï¼ˆå…­ï¼‰è‡ªç”±å®‰æ’ãƒ»é«”åŠ›å›å¾©æ—¥",
            summary: "è¦–é«”åŠ›é¸æ“‡æœ­å¹Œè»Šç«™å‘¨é‚Šé€›è¡—ã€JR Tower å±•æœ›å°ï¼Œæˆ–åœ¨é£¯åº—å¤§æµ´å ´æ”¾é¬†ã€‚",
            area: "æœ­å¹Œè»Šç«™å‘¨é‚Š",
            spots: [
              {
                name: "JR Tower å±•æœ›å° T38",
                category: "æ™¯é»",
                mapsQuery: "JRã‚¿ãƒ¯ãƒ¼ å±•æœ›å®¤ T38",
                note: "å®¤å…§çœ‹æœ­å¹Œå¸‚æ™¯çš„å¥½é¸æ“‡ã€‚",
                icon: "ğŸ™ï¸",
              },
              {
                name: "æœ­å¹Œç«™è³¼ç‰©å€",
                category: "æ™¯é»",
                mapsQuery: "æœ­å¹Œé§… å•†æ¥­æ–½è¨­",
                note: "å¤§ä¸¸ã€Stellar Place ç­‰å•†å ´æ…¢æ…¢é€›ã€‚",
                icon: "ğŸ›’",
              },
            ],
          },
          {
            id: "d7",
            display: 7,
            shortTitle: "æ”¯ç¬æ¹–å†°æ¿¤ç¥­",
            title: "Day 7ï½œ2 / 1ï¼ˆæ—¥ï¼‰ç§»å‹•åˆ°åƒæ­² & æ”¯ç¬æ¹–å†°æ¿¤ç¥­",
            summary: "ä¸Šåˆé€€æˆ¿ç§»å‹•åˆ°åƒæ­²ï¼Œä¸‹åˆï½æ™šä¸Šåƒè§€æ”¯ç¬æ¹–å†°æ¿¤ç¥­ï¼ˆé è¨­è¨ˆç¨‹è»Šå¾€è¿”ï¼‰ã€‚",
            area: "åƒæ­²ãƒ»æ”¯ç¬æ¹–",
            spots: [
              {
                name: "åƒæ­²ç«™ï¼åƒæ­²å¸‚å€",
                category: "äº¤é€š",
                mapsQuery: "åƒæ­³é§… åŒ—æµ·é“",
                note: "å…ˆå…¥ä½ Chiyoda-cho 3-13 ä¸€å¸¶ä½å®¿ã€‚",
                icon: "ğŸš‰",
              },
              {
                name: "æ”¯ç¬æ¹–æº«æ³‰è¡—",
                category: "æ™¯é»",
                mapsQuery: "æ”¯ç¬æ¹–æ¸©æ³‰",
                note: "æ¹–é‚Šæ•£æ­¥ã€æ„Ÿå—å†°é›ªç’°å¢ƒã€‚",
                icon: "ğŸï¸",
              },
              {
                name: "æ”¯ç¬æ¹–å†°æ¿¤ç¥­æœƒå ´",
                category: "æ™¯é»",
                mapsQuery: "æ”¯ç¬æ¹– æ°·æ¿¤ã¾ã¤ã‚Š",
                note: "å†°é›•èˆ‡å¤œé–“é»ç‡ˆï¼Œéå¸¸å¯’å†·ï¼Œé è¨ˆä»¥è¨ˆç¨‹è»Šå¾€è¿”ã€‚",
                icon: "â„ï¸",
              },
            ],
          },
          {
            id: "d8",
            display: 8,
            shortTitle: "æ–°åƒæ­²æ©Ÿå ´ä¸€æ—¥éŠ",
            title: "Day 8ï½œ2 / 2ï¼ˆä¸€ï¼‰æ–°åƒæ­²æ©Ÿå ´æ¨‚åœ’æ—¥",
            summary: "ä¸€æ•´å¤©å¾…åœ¨æ–°åƒæ­²æ©Ÿå ´ï¼šHello Kittyã€Royce å·§å…‹åŠ›ä¸–ç•Œã€æ©Ÿå ´æº«æ³‰ã€æ‹‰éºµé“å ´ã€‚",
            area: "æ–°åƒæ­²æ©Ÿå ´",
            spots: [
              {
                name: "Hello Kitty Happy Flight",
                category: "æ™¯é»",
                mapsQuery: "HELLO KITTY HAPPY FLIGHT æ–°åƒæ­³",
                note: "ä¸»é¡Œå±•èˆ‡æ‹ç…§å€ï¼Œé©åˆè¼•é¬†æ…¢é€›ã€‚",
                icon: "ğŸ€",
              },
              {
                name: "Royce' Chocolate World",
                category: "æ™¯é»",
                mapsQuery: "Royce' Chocolate World æ–°åƒæ­³ç©ºæ¸¯",
                note: "å·§å…‹åŠ›å·¥å»  + åšç‰©é¤¨ + ä¼´æ‰‹ç¦®ã€‚",
                icon: "ğŸ«",
              },
              {
                name: "æ–°åƒæ­²æ©Ÿå ´æº«æ³‰",
                category: "æ™¯é»",
                mapsQuery: "æ–°åƒæ­³ç©ºæ¸¯æ¸©æ³‰",
                note: "æ³¡æ¹¯æ”¾é¬†è…¿ï¼Œå®Œå…¨å®¤å…§ä¸æ€•å†·ã€‚",
                icon: "â™¨ï¸",
              },
              {
                name: "æ‹‰éºµé“å ´",
                category: "ç¾é£Ÿ",
                mapsQuery: "æ–°åƒæ­³ç©ºæ¸¯ ãƒ©ãƒ¼ãƒ¡ãƒ³é“å ´",
                note: "ä¸€æ¬¡åƒåˆ°å¤šå®¶åŒ—æµ·é“æ‹‰éºµååº—ã€‚",
                icon: "ğŸœ",
              },
            ],
          },
          {
            id: "d9",
            display: 9,
            shortTitle: "å›ç¨‹ãƒ»æœ€å¾Œæ¡è²·",
            title: "Day 9ï½œ2 / 3ï¼ˆäºŒï¼‰å›ç¨‹æ—¥",
            summary: "Check-out å¾Œå‰å¾€æ–°åƒæ­²æ©Ÿå ´ï¼Œæœ€å¾Œæ¡è²·ä¼´æ‰‹ç¦®ï¼Œæ­æ©Ÿå›å°ç£ã€‚",
            area: "åƒæ­²ãƒ»æ–°åƒæ­²æ©Ÿå ´",
            spots: [
              {
                name: "æ–°åƒæ­²æ©Ÿå ´ ä¼´æ‰‹ç¦®å€",
                category: "ç¾é£Ÿ",
                mapsQuery: "æ–°åƒæ­³ç©ºæ¸¯ ãŠåœŸç”£",
                note: "ç™½è‰²æˆ€äººã€Royceã€è–¯æ¢ä¸‰å…„å¼Ÿç­‰ä¸€æ¬¡è²·é½Šã€‚",
                icon: "ğŸ›ï¸",
              },
              {
                name: "æ–°åƒæ­²æ©Ÿå ´åœ‹éš›ç·šå‡ºå¢ƒ",
                category: "äº¤é€š",
                mapsQuery: "æ–°åƒæ­³ç©ºæ¸¯ å›½éš›ç·š å‡ºç™º",
                note: "èµ·é£›å‰ 2.5ã€œ3 å°æ™‚åˆ°æ©Ÿå ´æœ€å®‰å¿ƒã€‚",
                icon: "âœˆï¸",
              },
            ],
          },
        ],
      };
    },
    computed: {
      currentDay() {
        return this.days.find(d => d.id === this.currentDayId) || this.days[0];
      },
      mapEmbedUrl() {
        const q = encodeURIComponent(this.currentSpot.mapsQuery || this.currentSpot.name);
        return `https://www.google.com/maps?q=${q}&output=embed`;
      },
      convertedTwd() {
        const rate = parseFloat(this.rateTwdPerJpy);
        const yen = parseFloat(this.yenInput);
        if (!rate || !yen) return "";
        return Math.round(yen * rate).toString();
      },
      cassandraProgressBar() {
        const b = this.budgetJpy("cassandra");
        if (!b || b <= 0) return 0;
        const used = this.totalSpent("cassandra");
        return Math.min(100, Math.round((used / b) * 100));
      },
      ivyProgressBar() {
        const b = this.budgetJpy("ivy");
        if (!b || b <= 0) return 0;
        const used = this.totalSpent("ivy");
        return Math.min(100, Math.round((used / b) * 100));
      },
    },
    methods: {
      selectDay(id) {
        this.currentDayId = id;
        const day = this.days.find(d => d.id === id);
        if (day && day.spots.length > 0) {
          this.currentSpot = day.spots[0];
        }
        this.ensureDailyNote(id);
        this.saveState();
      },
      setCurrentSpot(spot) {
        this.currentSpot = spot;
      },
      openMaps(query) {
        const q = encodeURIComponent(query);
        const url = `https://www.google.com/maps/search/?api=1&query=${q}`;
        window.open(url, "_blank");
      },
      budgetJpy(personKey) {
        const person = this.persons[personKey];
        if (!person) return null;
        const override = parseFloat(person.budgetJpyOverride);
        if (!isNaN(override) && override > 0) return Math.round(override);
        const rate = parseFloat(this.rateTwdPerJpy);
        const twd = parseFloat(person.budgetTwd);
        if (!isNaN(rate) && rate > 0 && !isNaN(twd) && twd > 0) {
          return Math.round(twd / rate);
        }
        return null;
      },
      totalSpent(personKey) {
        const person = this.persons[personKey];
        if (!person || !person.dailySpending) return 0;
        let sum = 0;
        for (const dayId of Object.keys(person.dailySpending)) {
          const v = parseFloat(person.dailySpending[dayId]);
          if (!isNaN(v)) sum += v;
        }
        return Math.round(sum);
      },
      remainingJpy(personKey) {
        const b = this.budgetJpy(personKey);
        if (b === null) return null;
        const used = this.totalSpent(personKey);
        return Math.max(0, b - used);
      },
      addPackingItem() {
        const text = (this.newPackingItem || "").trim();
        if (!text) return;
        this.packing.items.push({ text, done: false });
        this.newPackingItem = "";
        this.saveState();
      },
      ensureDailyNote(dayId) {
        if (!this.dailyNotes[dayId]) {
          this.dailyNotes[dayId] = { cassandra: "", ivy: "" };
        }
      },
      // å„²å­˜åˆ° localStorage
      saveState() {
        const state = {
          rateTwdPerJpy: this.rateTwdPerJpy,
          yenInput: this.yenInput,
          persons: this.persons,
          dailyNotes: this.dailyNotes,
          packing: this.packing,
          currentDayId: this.currentDayId,
          activeMainView: this.activeMainView,
        };
        try {
          localStorage.setItem("hokkaidoTripV3", JSON.stringify(state));
        } catch (e) {
          console.warn("ç„¡æ³•å„²å­˜ç‹€æ…‹åˆ° localStorageï¼š", e);
        }
      },
      loadState() {
        try {
          const raw = localStorage.getItem("hokkaidoTripV3");
          if (!raw) return;
          const saved = JSON.parse(raw);
          if (saved.rateTwdPerJpy !== undefined) this.rateTwdPerJpy = saved.rateTwdPerJpy;
          if (saved.yenInput !== undefined) this.yenInput = saved.yenInput;
          if (saved.persons) {
            this.persons = saved.persons;
          }
          if (saved.dailyNotes) {
            this.dailyNotes = saved.dailyNotes;
          }
          if (saved.packing) {
            this.packing = saved.packing;
          }
          if (saved.currentDayId) {
            this.currentDayId = saved.currentDayId;
          }
          if (saved.activeMainView) {
            this.activeMainView = saved.activeMainView;
          }
        } catch (e) {
          console.warn("è®€å– localStorage å¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼ï¼š", e);
        }
      },
      initDailyStructures() {
        // ç¢ºä¿æ¯å€‹äººéƒ½æœ‰æ¯ä¸€å¤©çš„ dailySpending æ¬„ä½
        for (const key of ["cassandra", "ivy"]) {
          const person = this.persons[key];
          if (!person.dailySpending) person.dailySpending = {};
          this.days.forEach(day => {
            if (!(day.id in person.dailySpending)) {
              person.dailySpending[day.id] = "";
            }
          });
        }
        // ç¢ºä¿æ¯æ—¥å°è¨˜å­˜åœ¨
        this.days.forEach(day => {
          this.ensureDailyNote(day.id);
        });
      },
    },
    mounted() {
      // å…ˆè¼‰å…¥ localStorage
      this.loadState();
      // åˆå§‹åŒ–çµæ§‹
      this.initDailyStructures();

      // åˆå§‹åŒ–ç•¶å‰æ™¯é»
      const day = this.days.find(d => d.id === this.currentDayId);
      if (day && day.spots[0]) {
        this.currentSpot = day.spots[0];
      }
    },
  }).mount("#app");
</script>
</body>
</html>



